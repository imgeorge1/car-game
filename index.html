<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>car game</title>
    <script src="//cdn.jsdelivr.net/npm/phaser@3.11.0/dist/phaser.js"></script>
    <link rel="icon" type="image/x-icon" href="" />
    <style type="text/css">
      body {
        margin: 0;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <script type="text/javascript">
      const config = {
        type: Phaser.AUTO,
        width: 600,
        height: 750,
        physics: {
          default: "arcade",
          arcade: {
            gravity: { y: 0 },
            debug: false,
          },
        },
        scene: {
          preload: preload,
          create: create,
          update: update,
        },
      };

      //variables
      let player;
      let cursors;
      let enemy;
      let score = 0;
      let scoreText;
      var gameOver = false;
      var alerted = false;
      let game = new Phaser.Game(config);
      let details;
      // let carsList;
      let trucks;
      let sedans;
      let compacts;
      let supercars;
      let intervalFunction;

      //main functions
      function preload() {
        this.load.image("road", "assets/road.png");
        this.load.image("roadDetails", "assets/road_details.png");
        //trucks
        this.load.image("blue-truck", "assets/trucks/blue_truck.png");
        this.load.image("dark-truck", "assets/trucks/dark_truck.png");
        this.load.image("limo", "assets/trucks/limo.png");
        this.load.image("red-truck", "assets/trucks/red_truck.png");
        this.load.image("yellow-truck", "assets/trucks/yellow_truck.png");
        //sedans
        this.load.image("blue-sedan", "assets/sedans/blue_sedan.png");
        this.load.image("old-sedan", "assets/sedans/old_sedan.png");
        this.load.image("red-sedan", "assets/sedans/red_sedan.png");
        this.load.image("taxi", "assets/sedans/taxi.png");
        this.load.image("white-sedan", "assets/sedans/white_sedan.png");
        //supercars
        this.load.image("blue-super", "assets/supercars/blue_super.png");
        this.load.image("purple-super", "assets/supercars/purple_super.png");
        this.load.image("red-super", "assets/supercars/red_super.png");
        this.load.image("stripe-super", "assets/supercars/stripe_super.png");
        this.load.image("white-super", "assets/supercars/white_super.png");
        this.load.image("yellow-super", "assets/supercars/yellow_super.png");
        //compacts
        this.load.image("blue-compact", "assets/compacts/blue_compact.png");
        this.load.image("green-compact", "assets/compacts/green_compact.png");
        this.load.image("violet-compact", "assets/compacts/violet_compact.png");
        this.load.image("yellow-compact", "assets/compacts/yellow_compact.png");

        this.load.spritesheet("player", "assets/player_car.png", {
          frameWidth: 34,
          frameHeight: 64,
        });
      }

      function create() {
        //road
        this.add.image(300, 400, "road");
        //v creates a tileSprite
        this.details = this.add.tileSprite(300, 375, 600, 750, "roadDetails");
        //enemies

        trucks = [
          "blue-truck",
          "dark-truck",
          "limo",
          "red-truck",
          "yellow-truck",
        ];
        sedans = [
          "blue-sedan",
          "old-sedan",
          "red-sedan",
          "taxi",
          "white-sedan",
        ];
        supercars = [
          "blue-super",
          "purple-super",
          "red-super",
          "stripe-super",
          "white-super",
          "yellow-super",
        ];
        compacts = [
          "blue-compact",
          "green-compact",
          "violet-compact",
          "yellow-compact",
        ];
        enemy = this.physics.add.group();
        this.physics.add.collider(enemy, enemy);
        // smallcarsList = ["zhiguli"];
        //enemy spawner
        //
        // enemy.create(
        //   Phaser.Math.RND.between(100, 350),
        //   -500,
        //   Phaser.Math.RND.pick(smallcarsList)
        // );
        // if (Phaser.Math.RND.pick(fallingItems) === "ball") {
        //   score += 10;
        // }
        // score += 1;
        // scoreText.setText("Score: " + score);
        function intervalFunction() {
          setInterval(function () {
            enemy
              .create(
                Phaser.Math.RND.between(10, 590),
                -500,
                Phaser.Math.RND.pick(trucks)
              )
              .setVelocity(0, 200);
          }, 2000);
        }
        function intervalFunction2() {
          setInterval(function () {
            enemy
              .create(
                Phaser.Math.RND.between(10, 590),
                -500,
                Phaser.Math.RND.pick(supercars)
              )
              .setVelocity(0, 600);
          }, 1200);
        }
        function intervalFunction3() {
          setInterval(function () {
            enemy
              .create(
                Phaser.Math.RND.between(10, 590),
                -500,
                Phaser.Math.RND.pick(compacts)
              )
              .setVelocity(0, 300);
          }, 600);
        }
        function intervalFunction4() {
          setInterval(function () {
            enemy
              .create(
                Phaser.Math.RND.between(10, 590),
                -500,
                Phaser.Math.RND.pick(sedans)
              )
              .setVelocity(0, 400);
          }, 900);
        }
        intervalFunction();
        intervalFunction2();
        intervalFunction3();
        intervalFunction4();

        //player
        this.player = this.physics.add.sprite(300, 500, "player");
        gamer = this.player;
        gamer.body.setSize(34, 64);
        //player settings
        this.player.setCollideWorldBounds(true);
        //input
        cursors = this.input.keyboard.createCursorKeys();
        this.physics.add.collider(gamer, enemy, hitEnemy, null, this);
      }

      function update() {
        if (gameOver == true) {
          if (alerted === false) {
            //the alert box telling you that game is over and showing your score
            alert("GAME OVER!\nYour score: " + score);
            //setting alerted variable to true so this alert appears only once
            alerted = true;
            //reloading the page after clicking on "ok"
            window.location.reload();
          }
        }
        //v animates the tileSprite
        this.details.tilePositionY -= 3;
        //move left and right
        if (cursors.left.isDown) {
          //go left
          this.player.setVelocityX(-250);
          this.player.setVelocityY(0);
        } else if (cursors.right.isDown) {
          //go right
          this.player.setVelocityX(250);
          this.player.setVelocityY(0);
        } else {
          //do nothing
          this.player.setVelocityX(0);
        }

        if (cursors.up.isDown) {
          //go up
          this.player.setVelocityY(-100);
        } else if (cursors.down.isDown) {
          this.player.setVelocityY(100);
        } else {
          this.player.setVelocityY(0);
        }

        if (cursors.up.isDown && cursors.down.isDown) {
          this.player.rotation -= 0.2;
          this.player.setVelocityY(0);
        } else {
          this.player.rotation = 0;
        }
      }
      function hitEnemy(player, enemy) {
        gameOver = true;
      }
    </script>
  </body>
</html>
